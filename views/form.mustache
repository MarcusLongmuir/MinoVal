<script src="{{{minoval_path}}}jquery/dist/jquery.js"></script>

<script src="{{{minoval_path}}}fieldval/fieldval.js"></script>
<script src="{{{minoval_path}}}fieldval-basicval/fieldval-basicval.js"></script>
<script src="{{{minoval_path}}}fieldval-ui/fieldval-ui.js"></script>
<script src="{{{minoval_path}}}fieldval-rules-js/fieldval-rules.js"></script>

<!-- Apply the "minimal" theme to FieldVal-UI -->
<link rel="stylesheet" type="text/css" href="{{{minoval_path}}}fieldval-ui/themes/minimal.css">
<script src="{{{minoval_path}}}fieldval-ui/themes/minimal.js"></script>

<script>
$(document).ready(function(){

    var type_object = {{{rule}}};

    if (type_object === null) {
    	var message = $("<p/>").text("Form doesn't exist");
    	$("body").append(message);
    	return;
    }

    var vr = new ValidationRule();
	var rule_error = vr.init(type_object);
    if(rule_error){
        console.error(rule_error);
        return;
    }

	var form = vr.create_form();

    form.val({
    	user: {
    		id: 123,
    		first_name: 123,
    		last_name: 123,
    		Address: 123,
    		company_id: 123
    	},
    })

	$("body").append(
		form.element.append(
			$("<button />").text("Submit")
		),
		output = $("<pre />")
	)

	form.on_submit(function(object){

	    var error = vr.validate(object);
	  
		if(error){
			console.log(error);
			form.error(error)
			output.text('"error": '+JSON.stringify(error,null,4));
		} else {
			form.clear_errors();
			output.text('"object": '+JSON.stringify(object,null,4));

			var path = location.pathname.split('/');
			var url = '{{{minoval_paath}}}endpoint/' + path[path.length-1];

			$.ajax({
		        type: "POST",
		        url: url,
		        contentType: "application/json; charset=utf-8",
		        dataType: "json",
		        data: JSON.stringify(object),
		        success: function(response) {
		            console.log(response);
		        },
		        error: function(err, response) {
		        	console.log(err, response);
		        }
		    })
		}
	})
})
</script>